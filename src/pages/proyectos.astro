---
// Importa el layout
import Layout from '../layouts/Layout.astro';

// FunciÃ³n para obtener la URL de la imagen destacada
async function getFeaturedImageUrl(featuredMediaId) {
  if (!featuredMediaId) return null;
  const mediaRes = await fetch(`https://www.elsaltoweb.es/wp-json/wp/v2/media/${featuredMediaId}`);
  const mediaData = await mediaRes.json();
  return mediaData.source_url || null;
}

// Obtiene las entradas desde la API de WordPress
const res = await fetch("https://www.elsaltoweb.es/wp-json/wp/v2/posts");
const posts = await res.json();

// Obtiene la URL de la imagen destacada para cada post
for (const post of posts) {
  post.featured_media_url = await getFeaturedImageUrl(post.featured_media);
}
---

<Layout>
  <h1>Astro + WordPress ðŸš€</h1>
  <div class="post-grid">
    {
      posts.map((post) => (
        <div class="post-card">
          {post.featured_media_url && <img src={post.featured_media_url} alt={post.title.rendered} class="post-image"/>}
          <h2 set:html={post.title.rendered} class="post-title"/>
          <p set:html={post.excerpt.rendered} class="post-excerpt"/>
        </div>
      ))
    }
  </div>

  <style>
    .post-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .post-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .post-card:hover {
      transform: translateY(-5px);
    }
    .post-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .post-title {
      font-size: 1.5rem;
      margin: 15px;
      color: #e9e9e9;
    }
    .post-excerpt {
      padding: 0 15px 15px;
      color: #e9e9e9;
    }
  </style>
</Layout>
